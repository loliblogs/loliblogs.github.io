import"./compat.module.eoMXoyo6.js";import{y as t}from"./hooks.module.7OROTjBQ.js";import"./preact.module.C1TiR6ni.js";function e(t){const e=new Date(t);if(isNaN(e.getTime()))return"";return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}const n={ArrowLeft:-1,ArrowDown:-1,ArrowRight:1,ArrowUp:1,PageDown:-10,PageUp:10,Home:-1/0,End:1/0};function a(t){if(!t)return null;const e=new Date(t);return Number.isNaN(e.getTime())?null:e}function r(t,e,n){if(n===e)return 50;const a=(t.getTime()-e)/(n-e)*100;return Math.max(0,Math.min(100,a))}function s(t,e,n){return new Date(e+(n-e)*t/100)}function o(t){return 100*t.getFullYear()+(t.getMonth()+1)}function i(t,e,n){const{startDate:a,endDate:r}=n;return"start"===t?e>r?{startDate:r,endDate:e}:{startDate:e,endDate:r}:e<a?{startDate:e,endDate:a}:{startDate:a,endDate:e}}function l(t,n,a,s){const o=r(n.startDate,a,s),i=r(n.endDate,a,s);t.track.style.setProperty("--slider-start",`${o}%`),t.track.style.setProperty("--slider-end",`${i}%`),t.track.style.setProperty("--slider-width",i-o+"%"),t.thumbStart.setAttribute("aria-valuenow",String(Math.round(o))),t.thumbEnd.setAttribute("aria-valuenow",String(Math.round(i))),t.thumbStart.setAttribute("aria-valuetext",e(n.startDate)),t.thumbEnd.setAttribute("aria-valuetext",e(n.endDate))}function u(t,n){const a=e(n.startDate),r=e(n.endDate);t.labelStart.textContent=a,t.labelEnd.textContent=r,t.inputStart.value=a,t.inputEnd.value=r;const s=function(t,e){const n=e.startDate.getTime(),a=e.endDate.getTime(),r=o(e.startDate),s=o(e.endDate);let i=0;for(const o of t){const t=Number(o.dataset.ym),e=o.querySelectorAll('[data-role="item"]');if(t<r||t>s){o.classList.add("hidden");for(const t of e)t.classList.add("hidden")}else if(t===r||t===s){let t=!1;for(const r of e){const e=Number(r.dataset.timestamp),s=!Number.isNaN(e)&&e>=n&&e<=a;r.classList.toggle("hidden",!s),s&&(i++,t=!0)}o.classList.toggle("hidden",!t)}else{o.classList.remove("hidden");for(const t of e)t.classList.remove("hidden");i+=e.length}}return i}(t.sections,n);t.emptyState.classList.toggle("hidden",s>0),t.visibleCount.textContent=String(s);const i=new URLSearchParams(window.location.search);i.set("start",a),i.set("end",r);const l=`${window.location.pathname}?${i.toString()}`;window.history.replaceState({},"",l)}function c(t,e,n,a,r,o,l,u){function c(u){u.preventDefault(),t.focus();const c="touches"in u,d=c?"touchmove":"mousemove",m=c?"touchend":"mouseup",D=n.track.getBoundingClientRect(),h=t=>{const n="touches"in t?t.touches[0]?.clientX:t.clientX;if(null==n)return;const u=s(Math.max(0,Math.min(100,(n-D.left)/D.width*100)),o,l),c=i(e,u,a);r(c)},g=()=>{document.removeEventListener(d,h),document.removeEventListener(m,g)};document.addEventListener(d,h,{passive:!1}),document.addEventListener(m,g)}t.addEventListener("mousedown",c,{signal:u}),t.addEventListener("touchstart",c,{signal:u})}function d(){return t(()=>{const t=document.querySelector('[data-role="timeline"]');if(!t)return;const e=function(t){const e=t.querySelector('[data-role="track"]'),n=t.querySelector('[data-role="thumb-start"]'),a=t.querySelector('[data-role="thumb-end"]'),r=t.querySelector('[data-role="input-start"]'),s=t.querySelector('[data-role="input-end"]'),o=t.querySelector('[data-role="label-start"]'),i=t.querySelector('[data-role="label-end"]'),l=t.querySelector('[data-role="presets"]'),u=Array.from(t.querySelectorAll('[data-role="section"]')),c=t.querySelector('[data-role="empty"]'),d=t.querySelector('[data-role="count-visible"]'),m=t.querySelector('[data-role="custom"] > summary'),D=m?.closest("details");return e&&n&&a&&r&&s&&o&&i&&l&&0!==u.length&&c&&d&&m&&D?{track:e,thumbStart:n,thumbEnd:a,inputStart:r,inputEnd:s,labelStart:o,labelEnd:i,presets:l,sections:u,emptyState:c,visibleCount:d,customSummary:m,customDetails:D}:(console.error("TimelineFilterClient: missing required elements"),null)}(t);if(!e)return;const o=Number(t.getAttribute("data-min-time")),d=Number(t.getAttribute("data-max-time")),m=new AbortController,{signal:D}=m;let h=function(t,e){const n=new URLSearchParams(window.location.search);let r=a(n.get("start"))??new Date(t),s=a(n.get("end"))??new Date(e);return r>s&&(r=new Date(t),s=new Date(e)),{startDate:r,endDate:s}}(o,d),g=null;l(e,h,o,d),u(e,h),function(t,e){const n=new URLSearchParams(window.location.search),r=a(n.get("focus"));if(!r)return;n.delete("focus");const s=`${window.location.pathname}?${n.toString()}`;window.history.replaceState({},"",s);const o=e.startDate.getTime(),i=e.endDate.getTime(),l=r.getTime();if(l<o||l>i)return;let u=null,c=1/0;for(const a of t.sections)if(!a.classList.contains("hidden"))for(const t of a.querySelectorAll('[data-role="item"]')){if(t.classList.contains("hidden"))continue;const e=Number(t.dataset.timestamp);if(Number.isNaN(e))continue;const n=Math.abs(e-l);n<c&&(c=n,u=t)}u&&(u.scrollIntoView({behavior:"auto",block:"center"}),u.classList.add("animate-[highlight-flash_2s_ease-in-out]"),window.setTimeout(()=>{u.classList.remove("animate-[highlight-flash_2s_ease-in-out]")},2e3))}(e,h);const f=t=>{h=t,l(e,h,o,d),g&&cancelAnimationFrame(g),g=requestAnimationFrame(()=>{u(e,h),g=null})};return c(e.thumbStart,"start",e,h,f,o,d,D),c(e.thumbEnd,"end",e,h,f,o,d,D),function(t,e,n,r){t.inputStart.addEventListener("change",t=>{const r=a(t.target.value);!r||r.getFullYear()<1e3||r>e.endDate||n({startDate:r,endDate:e.endDate})},{signal:r}),t.inputEnd.addEventListener("change",t=>{const r=a(t.target.value);!r||r.getFullYear()<1e3||r<e.startDate||n({startDate:e.startDate,endDate:r})},{signal:r})}(e,h,f,D),function(t,e,n,a,r){t.presets.addEventListener("click",t=>{const r=t.target.closest("button[data-preset]");if(!r)return;const s=new Date,o=s.getFullYear();switch(r.getAttribute("data-preset")){case"all":e({startDate:new Date(n),endDate:new Date(a)});break;case"this-year":e({startDate:new Date(o,0,1),endDate:new Date(o,11,31)});break;case"last-year":e({startDate:new Date(o-1,0,1),endDate:new Date(o-1,11,31)});break;case"last-3m":e({startDate:new Date(s.getFullYear(),s.getMonth()-3,s.getDate()),endDate:s});break;case"last-6m":e({startDate:new Date(s.getFullYear(),s.getMonth()-6,s.getDate()),endDate:s})}},{signal:r})}(e,f,o,d,D),function(t,e,a,o,l,u){const c=u=>{const c=u.target,d=c===t.thumbStart,m=c===t.thumbEnd;if(!d&&!m)return;const D=n[u.key];if(void 0===D)return;u.preventDefault();const h=d?"start":"end",g=r(d?e.startDate:e.endDate,o,l),f=i(h,s(Math.max(0,Math.min(100,g+D)),o,l),e);a(f)};t.thumbStart.addEventListener("keydown",c,{signal:u}),t.thumbEnd.addEventListener("keydown",c,{signal:u})}(e,h,f,o,d,D),function(t,e){document.addEventListener("pointerdown",e=>{if(!t.customDetails.open)return;const n=e.target;n&&!t.customDetails.contains(n)&&(t.customDetails.open=!1)},{signal:e}),document.addEventListener("keydown",e=>{"Escape"===e.key&&t.customDetails.open&&(t.customDetails.open=!1,t.customSummary.focus())},{signal:e})}(e,D),()=>{m.abort(),g&&cancelAnimationFrame(g)}},[]),null}export{d as default};
//# sourceMappingURL=TimelineFilterClient.COnLkzY3.js.map
