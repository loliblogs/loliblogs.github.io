{"version":3,"file":"TimelineFilterClient.CLR_WYj1.js","sources":["../../src/utils/date-helpers.ts","../../src/components/TimelineFilterClient.tsx"],"sourcesContent":["/**\n * 日期格式化 - 极简版\n *\n * \"Talk is cheap. Show me the code.\" - Linus\n * 25行解决问题，不需要500行\n */\n\n/**\n * 格式化日期为 YYYY-MM-DD\n *\n * @param date 日期输入\n * @returns YYYY-MM-DD 格式的日期字符串\n */\nexport function formatDate(date: Date | string | number): string {\n  const d = new Date(date);\n\n  if (isNaN(d.getTime())) {\n    return '';\n  }\n\n  const year = d.getFullYear();\n  const month = String(d.getMonth() + 1).padStart(2, '0');\n  const day = String(d.getDate()).padStart(2, '0');\n\n  return `${year}-${month}-${day}`;\n}\n\n/**\n * 格式化日期为 MM/DD\n *\n * @param date 日期对象\n * @returns MM/DD 格式的字符串\n */\nexport function formatMonthDay(date: Date): string {\n  const month = String(date.getMonth() + 1).padStart(2, '0');\n  const day = String(date.getDate()).padStart(2, '0');\n  return `${month}/${day}`;\n}\n","import { useEffect } from 'react';\nimport { formatDate } from '@/utils/date-helpers';\n\ninterface DateRange {\n  startDate: Date;\n  endDate: Date;\n  startTime: number;  // 缓存的时间戳\n  endTime: number;    // 缓存的时间戳\n}\n\nfunction parseDate(value: string | null): Date | null {\n  if (!value) return null;\n  const parsed = new Date(value);\n  return isNaN(parsed.getTime()) ? null : parsed;\n}\n\nfunction dateToPercent(date: Date, minTime: number, maxTime: number): number {\n  if (maxTime === minTime) return 50;\n  const percent = ((date.getTime() - minTime) / (maxTime - minTime)) * 100;\n  return Math.max(0, Math.min(100, percent));\n}\n\nfunction percentToDate(percent: number, minTime: number, maxTime: number): Date {\n  const time = minTime + (maxTime - minTime) * percent / 100;\n  return new Date(time);\n}\n\nexport default function TimelineFilterClient() {\n  useEffect(() => {\n    const timeline = document.querySelector<HTMLElement>('[data-role=\"timeline\"]');\n    if (!timeline) return;\n\n    const track = timeline.querySelector<HTMLDivElement>('[data-role=\"track\"]');\n    const thumbStart = timeline.querySelector<HTMLDivElement>('[data-role=\"thumb-start\"]');\n    const thumbEnd = timeline.querySelector<HTMLDivElement>('[data-role=\"thumb-end\"]');\n    const inputStart = timeline.querySelector<HTMLInputElement>('[data-role=\"input-start\"]');\n    const inputEnd = timeline.querySelector<HTMLInputElement>('[data-role=\"input-end\"]');\n    const labelStart = timeline.querySelector<HTMLElement>('[data-role=\"label-start\"]');\n    const labelEnd = timeline.querySelector<HTMLElement>('[data-role=\"label-end\"]');\n    const presets = timeline.querySelector<HTMLElement>('[data-role=\"presets\"]');\n    const sections = Array.from(timeline.querySelectorAll<HTMLElement>('[data-role=\"section\"]'));\n    const emptyState = timeline.querySelector<HTMLElement>('[data-role=\"empty\"]');\n    const visibleCount = timeline.querySelector<HTMLElement>('[data-role=\"count-visible\"]');\n    const customSummary = timeline.querySelector<HTMLElement>('[data-role=\"custom\"] > summary');\n    const customDetails = customSummary?.closest('details') as HTMLDetailsElement | null;\n\n    if (!track || !thumbStart || !thumbEnd || !inputStart || !inputEnd || !labelStart\n      || !labelEnd || !presets || sections.length === 0 || !emptyState || !visibleCount\n      || !customSummary || !customDetails) {\n      console.error('TimelineFilterClient: missing required elements');\n      return;\n    }\n\n    // 创建类型安全的元素对象（验证后这些都是非空的）\n    const safeElements = {\n      track,\n      thumbStart,\n      thumbEnd,\n      inputStart,\n      inputEnd,\n      labelStart,\n      labelEnd,\n      presets,\n      sections,\n      emptyState,\n      visibleCount,\n      customSummary,\n      customDetails,\n    } as const;\n\n    const minTime = Number(timeline.getAttribute('data-min-time'));\n    const maxTime = Number(timeline.getAttribute('data-max-time'));\n\n    // 使用 AbortController 统一管理所有事件监听器\n    const controller = new AbortController();\n    const { signal } = controller;\n\n    let currentRange: DateRange = initializeRangeFromUrl(minTime, maxTime);\n    let rafId: number | null = null;\n\n    updateSliderCssVariables(currentRange);\n    applyRangeToDomAndUrl(currentRange);\n    highlightFocusedItem(currentRange);\n\n    // 统一的更新函数（视觉立即更新，DOM 节流）\n    const updateRange = (startDate: Date, endDate: Date) => {\n      currentRange = {\n        startDate,\n        endDate,\n        startTime: startDate.getTime(),\n        endTime: endDate.getTime(),\n      };\n      updateSliderCssVariables(currentRange);  // 立即更新视觉反馈\n\n      // 使用 requestAnimationFrame 节流 DOM 更新\n      if (rafId) cancelAnimationFrame(rafId);\n      rafId = requestAnimationFrame(() => {\n        applyRangeToDomAndUrl(currentRange);\n        rafId = null;\n      });\n    };\n\n    // 处理滑块拖动\n    function handleThumbDrag(thumb: HTMLDivElement, whichThumb: 'start' | 'end'): void {\n      function beginDrag(event: MouseEvent | TouchEvent): void {\n        event.preventDefault();\n        thumb.focus();\n        const isTouch = 'touches' in event;\n        const moveEvent = isTouch ? 'touchmove' : 'mousemove';\n        const endEvent = isTouch ? 'touchend' : 'mouseup';\n        const trackRect = safeElements.track.getBoundingClientRect();\n\n        const handleMove = (ev: MouseEvent | TouchEvent) => {\n          const clientX = 'touches' in ev ? ev.touches[0]?.clientX : ev.clientX;\n          if (clientX == null) return;\n          const percent = Math.max(0, Math.min(100, ((clientX - trackRect.left) / trackRect.width) * 100));\n          const newDate = percentToDate(percent, minTime, maxTime);\n          const { startDate, endDate } = currentRange;\n\n          if (whichThumb === 'start') {\n            if (newDate > endDate) {\n              updateRange(endDate, newDate);\n            } else {\n              updateRange(newDate, endDate);\n            }\n          } else {\n            if (newDate < startDate) {\n              updateRange(newDate, startDate);\n            } else {\n              updateRange(startDate, newDate);\n            }\n          }\n        };\n\n        const handleEnd = () => {\n          document.removeEventListener(moveEvent, handleMove);\n          document.removeEventListener(endEvent, handleEnd);\n        };\n\n        document.addEventListener(moveEvent, handleMove, { passive: false });\n        document.addEventListener(endEvent, handleEnd);\n      }\n\n      thumb.addEventListener('mousedown', beginDrag, { signal });\n      thumb.addEventListener('touchstart', beginDrag, { signal });\n    }\n\n    // 处理日期输入\n    function handleDateInputs(): void {\n      const handleStartChange = (e: Event) => {\n        const value = (e.target as HTMLInputElement).value;\n        const date = parseDate(value);\n        if (!date) return;\n        const { endDate } = currentRange;\n        if (date <= endDate) updateRange(date, endDate);\n      };\n\n      const handleEndChange = (e: Event) => {\n        const value = (e.target as HTMLInputElement).value;\n        const date = parseDate(value);\n        if (!date) return;\n        const { startDate } = currentRange;\n        if (date >= startDate) updateRange(startDate, date);\n      };\n\n      safeElements.inputStart.addEventListener('change', handleStartChange, { signal });\n      safeElements.inputEnd.addEventListener('change', handleEndChange, { signal });\n    }\n\n    // 处理预设按钮\n    function handlePresetButtons(): void {\n      const handleClick = (e: Event) => {\n        const target = (e.target as HTMLElement).closest('button[data-preset]');\n        if (!target) return;\n        const now = new Date();\n        const currentYear = now.getFullYear();\n        const preset = target.getAttribute('data-preset');\n\n        switch (preset) {\n          case 'all':\n            updateRange(new Date(minTime), new Date(maxTime));\n            break;\n          case 'this-year':\n            updateRange(new Date(currentYear, 0, 1), new Date(currentYear, 11, 31));\n            break;\n          case 'last-year':\n            updateRange(new Date(currentYear - 1, 0, 1), new Date(currentYear - 1, 11, 31));\n            break;\n          case 'last-3m':\n            updateRange(new Date(now.getFullYear(), now.getMonth() - 3, now.getDate()), now);\n            break;\n          case 'last-6m':\n            updateRange(new Date(now.getFullYear(), now.getMonth() - 6, now.getDate()), now);\n            break;\n        }\n      };\n\n      safeElements.presets.addEventListener('click', handleClick, { signal });\n    }\n\n    // 处理键盘控制\n    function handleKeyboardControl(): void {\n      const handleKeyDown = (e: KeyboardEvent) => {\n        const target = e.target as HTMLElement;\n        const isStart = target === safeElements.thumbStart;\n        const isEnd = target === safeElements.thumbEnd;\n\n        if (!isStart && !isEnd) return;\n\n        const { startDate, endDate } = currentRange;\n        const currentPercent = isStart\n          ? dateToPercent(startDate, minTime, maxTime)\n          : dateToPercent(endDate, minTime, maxTime);\n\n        let newPercent = currentPercent;\n\n        switch (e.key) {\n          case 'ArrowLeft':\n          case 'ArrowDown':\n            e.preventDefault();\n            newPercent = Math.max(0, currentPercent - 1);\n            break;\n          case 'ArrowRight':\n          case 'ArrowUp':\n            e.preventDefault();\n            newPercent = Math.min(100, currentPercent + 1);\n            break;\n          case 'PageDown':\n            e.preventDefault();\n            newPercent = Math.max(0, currentPercent - 10);\n            break;\n          case 'PageUp':\n            e.preventDefault();\n            newPercent = Math.min(100, currentPercent + 10);\n            break;\n          case 'Home':\n            e.preventDefault();\n            newPercent = 0;\n            break;\n          case 'End':\n            e.preventDefault();\n            newPercent = 100;\n            break;\n          default:\n            return;\n        }\n\n        const newDate = percentToDate(newPercent, minTime, maxTime);\n\n        if (isStart) {\n          if (newDate > endDate) {\n            updateRange(endDate, newDate);\n          } else {\n            updateRange(newDate, endDate);\n          }\n        } else {\n          if (newDate < startDate) {\n            updateRange(newDate, startDate);\n          } else {\n            updateRange(startDate, newDate);\n          }\n        }\n      };\n\n      safeElements.thumbStart.addEventListener('keydown', handleKeyDown, { signal });\n      safeElements.thumbEnd.addEventListener('keydown', handleKeyDown, { signal });\n    }\n\n    // 执行所有事件绑定\n    handleThumbDrag(safeElements.thumbStart, 'start');\n    handleThumbDrag(safeElements.thumbEnd, 'end');\n    handleDateInputs();\n    handlePresetButtons();\n    handleKeyboardControl();\n    handleCustomPanelOutsideClose();\n\n    function initializeRangeFromUrl(minTime: number, maxTime: number): DateRange {\n      const params = new URLSearchParams(window.location.search);\n      let startDate = parseDate(params.get('start')) ?? new Date(minTime);\n      let endDate = parseDate(params.get('end')) ?? new Date(maxTime);\n      if (startDate > endDate) {\n        startDate = new Date(minTime);\n        endDate = new Date(maxTime);\n      }\n      return {\n        startDate,\n        endDate,\n        startTime: startDate.getTime(),\n        endTime: endDate.getTime(),\n      };\n    }\n\n    function updateSliderCssVariables(range: DateRange): void {\n      const startPercent = dateToPercent(range.startDate, minTime, maxTime);\n      const endPercent = dateToPercent(range.endDate, minTime, maxTime);\n      safeElements.track.style.setProperty('--slider-start', `${startPercent}%`);\n      safeElements.track.style.setProperty('--slider-end', `${endPercent}%`);\n      safeElements.track.style.setProperty('--slider-width', `${endPercent - startPercent}%`);\n\n      // 更新 ARIA 值\n      safeElements.thumbStart.setAttribute('aria-valuenow', String(Math.round(startPercent)));\n      safeElements.thumbEnd.setAttribute('aria-valuenow', String(Math.round(endPercent)));\n      safeElements.thumbStart.setAttribute('aria-valuetext', formatDate(range.startDate));\n      safeElements.thumbEnd.setAttribute('aria-valuetext', formatDate(range.endDate));\n    }\n\n    function handleCustomPanelOutsideClose(): void {\n      const onPointerDown = (e: PointerEvent) => {\n        if (!safeElements.customDetails.open) return;\n        const target = e.target as Node | null;\n        if (target && !safeElements.customDetails.contains(target)) {\n          safeElements.customDetails.open = false;\n        }\n      };\n\n      const onKeyDown = (e: KeyboardEvent) => {\n        if (e.key === 'Escape' && safeElements.customDetails.open) {\n          safeElements.customDetails.open = false;\n          safeElements.customSummary.focus();\n        }\n      };\n\n      document.addEventListener('pointerdown', onPointerDown, { signal });\n      document.addEventListener('keydown', onKeyDown, { signal });\n    }\n\n    function applyRangeToDomAndUrl(range: DateRange): void {\n      safeElements.labelStart.textContent = formatDate(range.startDate);\n      safeElements.labelEnd.textContent = formatDate(range.endDate);\n      safeElements.inputStart.value = formatDate(range.startDate);\n      safeElements.inputEnd.value = formatDate(range.endDate);\n\n      // 计算边界年月\n      const startYM = range.startDate.getFullYear() * 100 + (range.startDate.getMonth() + 1);\n      const endYM = range.endDate.getFullYear() * 100 + (range.endDate.getMonth() + 1);\n\n      let visibleItemCount = 0;\n\n      // O(sections) 遍历，通常很少\n      for (const section of safeElements.sections) {\n        const sectionYM = Number(section.dataset.ym);\n\n        if (sectionYM < startYM || sectionYM > endYM) {\n          // 完全在范围外 - O(1) 隐藏整个 section\n          section.classList.add('hidden');\n          for (const item of section.querySelectorAll<HTMLElement>('[data-role=\"item\"]')) {\n            item.classList.add('hidden');\n          }\n        } else if (sectionYM === startYM || sectionYM === endYM) {\n          // 边界月份 - 需要精确检查每篇文章\n          let hasVisible = false;\n          for (const item of section.querySelectorAll<HTMLElement>('[data-role=\"item\"]')) {\n            const timestamp = Number(item.dataset.timestamp);\n            const isVisible = !isNaN(timestamp) && timestamp >= range.startTime && timestamp <= range.endTime;\n            item.classList.toggle('hidden', !isVisible);\n            if (isVisible) {\n              visibleItemCount++;\n              hasVisible = true;\n            }\n          }\n          section.classList.toggle('hidden', !hasVisible);\n        } else {\n          // 中间月份 - O(1) 显示所有\n          section.classList.remove('hidden');\n          const items = section.querySelectorAll<HTMLElement>('[data-role=\"item\"]');\n          for (const item of items) {\n            item.classList.remove('hidden');\n          }\n          visibleItemCount += items.length;\n        }\n      }\n\n      // 只在需要改变状态时才操作 DOM，避免不必要的重排\n      if (visibleItemCount === 0) {\n        safeElements.emptyState.classList.remove('hidden');\n      } else {\n        safeElements.emptyState.classList.add('hidden');\n      }\n      safeElements.visibleCount.textContent = String(visibleItemCount);\n\n      // 更新 URL 参数（只管范围，不管 focus）\n      const params = new URLSearchParams(window.location.search);\n      params.set('start', formatDate(range.startDate));\n      params.set('end', formatDate(range.endDate));\n      const newUrl = `${window.location.pathname}?${params.toString()}`;\n      window.history.replaceState({}, '', newUrl);\n    }\n\n    function highlightFocusedItem(range: DateRange): void {\n      const params = new URLSearchParams(window.location.search);\n      const focusValue = params.get('focus');\n      const focusDate = parseDate(focusValue);\n      if (!focusDate) return;\n\n      // 立即清理 focus 参数（一次性参数）\n      params.delete('focus');\n      const cleanUrl = `${window.location.pathname}?${params.toString()}`;\n      window.history.replaceState({}, '', cleanUrl);\n\n      if (focusDate < range.startDate || focusDate > range.endDate) return;\n\n      // 只在可见的 sections 中查找\n      let closestItem: HTMLElement | null = null;\n      let smallestDiff = Infinity;\n\n      const focusTime = focusDate.getTime();\n      for (const section of safeElements.sections) {\n        if (section.classList.contains('hidden')) continue;\n\n        for (const item of section.querySelectorAll<HTMLElement>('[data-role=\"item\"]')) {\n          if (item.classList.contains('hidden')) continue;\n          const timestamp = Number(item.dataset.timestamp);\n          if (isNaN(timestamp)) continue;\n          const diff = Math.abs(timestamp - focusTime);\n          if (diff < smallestDiff) {\n            smallestDiff = diff;\n            closestItem = item;\n          }\n        }\n      }\n\n      if (!closestItem) return;\n      closestItem.scrollIntoView({ behavior: 'smooth', block: 'center' });\n      closestItem.classList.add('animate-[highlight-flash_2s_ease-in-out]');\n      window.setTimeout(() => {\n        closestItem.classList.remove('animate-[highlight-flash_2s_ease-in-out]');\n      }, 2000);\n    }\n\n    return () => {\n      controller.abort(); // 一次性清理所有事件监听器\n      if (rafId) cancelAnimationFrame(rafId);\n    };\n  }, []);\n\n  return null;\n}\n"],"names":["formatDate","date","d","Date","isNaN","getTime","getFullYear","String","getMonth","padStart","getDate","parseDate","value","parsed","dateToPercent","minTime","maxTime","percent","Math","max","min","percentToDate","TimelineFilterClient","useEffect","timeline","document","querySelector","track","thumbStart","thumbEnd","inputStart","inputEnd","labelStart","labelEnd","presets","sections","Array","from","querySelectorAll","emptyState","visibleCount","customSummary","customDetails","closest","length","console","error","safeElements","Number","getAttribute","controller","AbortController","signal","currentRange","params","URLSearchParams","window","location","search","startDate","get","endDate","startTime","endTime","initializeRangeFromUrl","rafId","updateSliderCssVariables","applyRangeToDomAndUrl","range","focusDate","delete","cleanUrl","pathname","toString","history","replaceState","closestItem","smallestDiff","Infinity","focusTime","section","classList","contains","item","timestamp","dataset","diff","abs","scrollIntoView","behavior","block","add","setTimeout","remove","highlightFocusedItem","updateRange","requestAnimationFrame","handleThumbDrag","thumb","whichThumb","beginDrag","event","preventDefault","focus","isTouch","moveEvent","endEvent","trackRect","getBoundingClientRect","handleMove","ev","clientX","touches","newDate","left","width","handleEnd","removeEventListener","addEventListener","passive","startPercent","endPercent","style","setProperty","setAttribute","round","textContent","startYM","endYM","visibleItemCount","sectionYM","ym","hasVisible","isVisible","toggle","items","set","newUrl","e","target","now","currentYear","handleKeyDown","isStart","isEnd","currentPercent","newPercent","key","handleKeyboardControl","open","abort"],"mappings":"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"}