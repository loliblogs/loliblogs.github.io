import"./compat.module.eoMXoyo6.js";import{y as t}from"./hooks.module.7OROTjBQ.js";import"./preact.module.C1TiR6ni.js";function e(t){const e=new Date(t);if(isNaN(e.getTime()))return"";return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}function a(t){if(!t)return null;const e=new Date(t);return isNaN(e.getTime())?null:e}function n(t,e,a){if(a===e)return 50;const n=(t.getTime()-e)/(a-e)*100;return Math.max(0,Math.min(100,n))}function r(t,e,a){return new Date(e+(a-e)*t/100)}function s(){return t(()=>{const t=document.querySelector('[data-role="timeline"]');if(!t)return;const s=t.querySelector('[data-role="track"]'),o=t.querySelector('[data-role="thumb-start"]'),i=t.querySelector('[data-role="thumb-end"]'),l=t.querySelector('[data-role="input-start"]'),c=t.querySelector('[data-role="input-end"]'),u=t.querySelector('[data-role="label-start"]'),d=t.querySelector('[data-role="label-end"]'),m=t.querySelector('[data-role="presets"]'),h=Array.from(t.querySelectorAll('[data-role="section"]')),g=t.querySelector('[data-role="empty"]'),f=t.querySelector('[data-role="count-visible"]'),D=t.querySelector('[data-role="custom"] > summary'),w=D?.closest("details");if(!(s&&o&&i&&l&&c&&u&&d&&m&&0!==h.length&&g&&f&&D&&w))return void console.error("TimelineFilterClient: missing required elements");const b={track:s,thumbStart:o,thumbEnd:i,inputStart:l,inputEnd:c,labelStart:u,labelEnd:d,presets:m,sections:h,emptyState:g,visibleCount:f,customSummary:D,customDetails:w},p=Number(t.getAttribute("data-min-time")),S=Number(t.getAttribute("data-max-time")),v=new AbortController,{signal:y}=v;let L=function(t,e){const n=new URLSearchParams(window.location.search);let r=a(n.get("start"))??new Date(t),s=a(n.get("end"))??new Date(e);r>s&&(r=new Date(t),s=new Date(e));return{startDate:r,endDate:s,startTime:r.getTime(),endTime:s.getTime()}}(p,S),E=null;q(L),M(L),function(t){const e=new URLSearchParams(window.location.search),n=a(e.get("focus"));if(!n)return;e.delete("focus");const r=`${window.location.pathname}?${e.toString()}`;if(window.history.replaceState({},"",r),n<t.startDate||n>t.endDate)return;let s=null,o=1/0;const i=n.getTime();for(const a of b.sections)if(!a.classList.contains("hidden"))for(const t of a.querySelectorAll('[data-role="item"]')){if(t.classList.contains("hidden"))continue;const e=Number(t.dataset.timestamp);if(isNaN(e))continue;const a=Math.abs(e-i);a<o&&(o=a,s=t)}if(!s)return;s.scrollIntoView({behavior:"smooth",block:"center"}),s.classList.add("animate-[highlight-flash_2s_ease-in-out]"),window.setTimeout(()=>{s.classList.remove("animate-[highlight-flash_2s_ease-in-out]")},2e3)}(L);const k=(t,e)=>{L={startDate:t,endDate:e,startTime:t.getTime(),endTime:e.getTime()},q(L),E&&cancelAnimationFrame(E),E=requestAnimationFrame(()=>{M(L),E=null})};function A(t,e){function a(a){a.preventDefault(),t.focus();const n="touches"in a,s=n?"touchmove":"mousemove",o=n?"touchend":"mouseup",i=b.track.getBoundingClientRect(),l=t=>{const a="touches"in t?t.touches[0]?.clientX:t.clientX;if(null==a)return;const n=r(Math.max(0,Math.min(100,(a-i.left)/i.width*100)),p,S),{startDate:s,endDate:o}=L;"start"===e?n>o?k(o,n):k(n,o):n<s?k(n,s):k(s,n)},c=()=>{document.removeEventListener(s,l),document.removeEventListener(o,c)};document.addEventListener(s,l,{passive:!1}),document.addEventListener(o,c)}t.addEventListener("mousedown",a,{signal:y}),t.addEventListener("touchstart",a,{signal:y})}function q(t){const a=n(t.startDate,p,S),r=n(t.endDate,p,S);b.track.style.setProperty("--slider-start",`${a}%`),b.track.style.setProperty("--slider-end",`${r}%`),b.track.style.setProperty("--slider-width",r-a+"%"),b.thumbStart.setAttribute("aria-valuenow",String(Math.round(a))),b.thumbEnd.setAttribute("aria-valuenow",String(Math.round(r))),b.thumbStart.setAttribute("aria-valuetext",e(t.startDate)),b.thumbEnd.setAttribute("aria-valuetext",e(t.endDate))}function M(t){b.labelStart.textContent=e(t.startDate),b.labelEnd.textContent=e(t.endDate),b.inputStart.value=e(t.startDate),b.inputEnd.value=e(t.endDate);const a=100*t.startDate.getFullYear()+(t.startDate.getMonth()+1),n=100*t.endDate.getFullYear()+(t.endDate.getMonth()+1);let r=0;for(const e of b.sections){const s=Number(e.dataset.ym);if(s<a||s>n){e.classList.add("hidden");for(const t of e.querySelectorAll('[data-role="item"]'))t.classList.add("hidden")}else if(s===a||s===n){let a=!1;for(const n of e.querySelectorAll('[data-role="item"]')){const e=Number(n.dataset.timestamp),s=!isNaN(e)&&e>=t.startTime&&e<=t.endTime;n.classList.toggle("hidden",!s),s&&(r++,a=!0)}e.classList.toggle("hidden",!a)}else{e.classList.remove("hidden");const t=e.querySelectorAll('[data-role="item"]');for(const e of t)e.classList.remove("hidden");r+=t.length}}0===r?b.emptyState.classList.remove("hidden"):b.emptyState.classList.add("hidden"),b.visibleCount.textContent=String(r);const s=new URLSearchParams(window.location.search);s.set("start",e(t.startDate)),s.set("end",e(t.endDate));const o=`${window.location.pathname}?${s.toString()}`;window.history.replaceState({},"",o)}return A(b.thumbStart,"start"),A(b.thumbEnd,"end"),b.inputStart.addEventListener("change",t=>{const e=a(t.target.value);if(!e)return;const{endDate:n}=L;e<=n&&k(e,n)},{signal:y}),b.inputEnd.addEventListener("change",t=>{const e=a(t.target.value);if(!e)return;const{startDate:n}=L;e>=n&&k(n,e)},{signal:y}),b.presets.addEventListener("click",t=>{const e=t.target.closest("button[data-preset]");if(!e)return;const a=new Date,n=a.getFullYear();switch(e.getAttribute("data-preset")){case"all":k(new Date(p),new Date(S));break;case"this-year":k(new Date(n,0,1),new Date(n,11,31));break;case"last-year":k(new Date(n-1,0,1),new Date(n-1,11,31));break;case"last-3m":k(new Date(a.getFullYear(),a.getMonth()-3,a.getDate()),a);break;case"last-6m":k(new Date(a.getFullYear(),a.getMonth()-6,a.getDate()),a)}},{signal:y}),function(){const t=t=>{const e=t.target,a=e===b.thumbStart,s=e===b.thumbEnd;if(!a&&!s)return;const{startDate:o,endDate:i}=L,l=n(a?o:i,p,S);let c=l;switch(t.key){case"ArrowLeft":case"ArrowDown":t.preventDefault(),c=Math.max(0,l-1);break;case"ArrowRight":case"ArrowUp":t.preventDefault(),c=Math.min(100,l+1);break;case"PageDown":t.preventDefault(),c=Math.max(0,l-10);break;case"PageUp":t.preventDefault(),c=Math.min(100,l+10);break;case"Home":t.preventDefault(),c=0;break;case"End":t.preventDefault(),c=100;break;default:return}const u=r(c,p,S);a?u>i?k(i,u):k(u,i):u<o?k(u,o):k(o,u)};b.thumbStart.addEventListener("keydown",t,{signal:y}),b.thumbEnd.addEventListener("keydown",t,{signal:y})}(),document.addEventListener("pointerdown",t=>{if(!b.customDetails.open)return;const e=t.target;e&&!b.customDetails.contains(e)&&(b.customDetails.open=!1)},{signal:y}),document.addEventListener("keydown",t=>{"Escape"===t.key&&b.customDetails.open&&(b.customDetails.open=!1,b.customSummary.focus())},{signal:y}),()=>{v.abort(),E&&cancelAnimationFrame(E)}},[]),null}export{s as default};
//# sourceMappingURL=TimelineFilterClient.DJ3OnyM8.js.map
